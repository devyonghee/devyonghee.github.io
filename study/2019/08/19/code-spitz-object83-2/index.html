<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>devyonghee blog | 코드 스피츠 Object83 2회차 정리</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="코드 스피츠 Object83 2회차 정리">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://devyonghee.github.io/study/2019/08/19/code-spitz-object83-2/">
  <meta property="og:description" content="">
  <meta property="og:site_name" content="devyonghee blog">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="https://devyonghee.github.io/study/2019/08/19/code-spitz-object83-2/">
  <meta name="twitter:title" content="코드 스피츠 Object83 2회차 정리">
  <meta name="twitter:description" content="">

  
    <meta name="google-site-verification" content="1DbhSO778Ec8l_4qztuQgVDcPhc_ya64RGP-nwD_bj0" />
  

  
    <meta property="og:image" content="">
    <meta name="twitter:image" content="">
  

  <link href="https://devyonghee.github.io/feed.xml" type="application/rss+xml" rel="alternate" title="devyonghee blog Last 10 blog posts" />
  <link rel="stylesheet" type="text/css" href="/css/fonts.css">


  <link rel="icon" type="image/x-icon" href="/icons/favicon.ico">
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">

  

    
      <link rel="stylesheet" type="text/css" title="light" id="light" href="/css/light.css">
      <link rel="stylesheet" type="text/css" title="dark" id="dark" href="/css/dark.css" disabled="false">
    

  

</head>

<body>
  <main>
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav scrollappear">
  <a href="/" class="header-logo" title="devyonghee blog">devyonghee blog</a>
  <ul class="header-links">
    
      <li>
        <a href="/about" title="About me">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-about">
  <use href="/icons/about.svg#icon-about"
       xlink:href="/icons/about.svg#icon-about">
  </use>
</svg>

        </a>
      </li>
    

    
    <li>
      <a href="/tags" title="Tags">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon-tag">
  <use href="/icons/tag.svg#icon-tag"
       xlink:href="/icons/tag.svg#icon-tag">
  </use>
</svg>

      </a>
    </li>
    

    
    
    
    
      <li>
        <a href="https://github.com/devyonghee" rel="noreferrer noopener" target="_blank" title="GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-github">
  <use href="/icons/github.svg#icon-github"
       xlink:href="/icons/github.svg#icon-github">
  </use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
      <li>
        <a href="mailto:devyonghee@gmail.com" title="Email">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-email">
  <use href="/icons/email.svg#icon-email"
       xlink:href="/icons/email.svg#icon-email">
  </use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a href="/feed.xml" rel="noreferrer noopener" target="_blank" title="RSS">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-rss">
  <use href="/icons/rss.svg#icon-rss"
       xlink:href="/icons/rss.svg#icon-rss">
  </use>
</svg>

        </a>
      </li>
    
    
      <li>
        <a id="toggleBtn" title="Toggle Theme">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-theme">
  <use href="/icons/theme.svg#icon-theme"
       xlink:href="/icons/theme.svg#icon-theme">
  </use>
</svg>

        </a>
      </li>
    
  </ul>
</nav>
        <article class="article scrollappear">
          <header class="article-header">
            <h1>코드 스피츠 Object83 2회차 정리</h1>
            <p></p>
            <div class="article-list-footer">
  <span class="article-list-date">
    August 19, 2019
  </span>
  <span class="article-list-divider">-</span>
  <span class="article-list-minutes">
    
    
      20 minute read
    
  </span>
  <span class="article-list-divider">-</span>
  <div class="article-list-tags">
    
      <a href="/tag/study" title="See all posts with tag 'study'">study</a>
    
      <a href="/tag/book" title="See all posts with tag 'book'">book</a>
    
      <a href="/tag/object" title="See all posts with tag 'object'">object</a>
    
      <a href="/tag/OOP" title="See all posts with tag 'OOP'">OOP</a>
    
  </div>
</div>
          </header>

          <div class="article-content">
            <p>조건은 많아질수록 복잡해지고 제거할 수 없다.<br />
그러므로 최대한 역할을 나누는 것이 중요하고 객체 지향에서 이 역할을 타입을 통해 잘 표현해내야 한다.</p>

<!--more-->

<h2 id="type형">Type(형)</h2>

<p><strong>변수</strong>는 메모리 주소의 별명을 의미한다. 변수는 데이터 타입을 가지고 있는데 이 데이터 타입은 
해당 메모리 주소로 부터 얼만큼의 길이의 공간을 변수가 차지하는 공간을 의미한다.
객체 지향에서 <strong>type</strong>은 굉장히 중요한 의미를 가지지만 여기서 말하는 <strong>type</strong>은 데이터 타입을 의미하는 것은 아니다.
객체 지향에서는 모든 것을 <strong>type</strong>으로 바꿔서 생각해 볼 가치가 있다. <strong>type</strong>의 의미를 제대로 파악해보자.</p>

<p>이제 부터 말하는 <strong>type(형)</strong> 은 모두 참조 <strong>type(형)</strong> 을 의미한다.
객체 지향에서 유일하게 사용할 수 있는 것은 <strong>type(형)</strong> 이다.
객체 지향의 어떤 개념을 구현해도 <strong>type(형)</strong> 으로 구현할 수 밖에 없다. 
다시 말해, <strong>type(형)</strong> 으로 만들 수 있다면 그 개념을 구현할 수 있다.
즉, 우리는 객체 지향 언어에서 우리의 사고를 타입으로 전환하는 방법을 고려해봐야한다.
이러한 이야기는 강타입과 컴파일을 지원하는 언어에 해당되며, Objective-C나 대부분 Script 는 포함 되지 않는다.</p>

<ul>
  <li>Role : 형을 통해 역할을 묘사함
    <ul>
      <li>역할은 반드시 타입으로 구현되야 한다.</li>
      <li>type으로 구현하지 않으면 그 개념을 역할로써 형상화할 수 없다.</li>
      <li>어떤 역할을 정의했다면 그 역할은 타입으로 드러나게 된다.</li>
    </ul>
  </li>
  <li>Responsibility : 형을 통해 로직을 표현함
    <ul>
      <li>내가 수행해야 될 책임조차도 전부 형을 통해서 표현</li>
    </ul>
  </li>
  <li>Message : 형을 통해 메세지를 공유함
    <ul>
      <li>협력하기 위해 메세지를 주고 받을 때의 메세지조차도 전부 <strong>type(형)</strong> 으로 되어 있다.</li>
      <li>인자가 String이나 Int 같은 것이라면 값일뿐 <strong>type(형)</strong> 은 아니다.
        <blockquote>
          <p>값은 불변이며 복제된 객체를 만들어내며 본인의 상태에 대한 책임을 갖지 않는다. 
그래서 캡슐화를 할 수 없기 때문에 객체 지향의 원리를 이용할 수 없다. 
그러므로 우리가 원하는 로직이나 메세지를 받으면 무조건 형으로 바꿔야 한다.</p>
        </blockquote>
      </li>
    </ul>
  </li>
  <li>Protocol : 객체 간 계약을 형을 통해 공유함
    <ul>
      <li>양자가 협의의 의해서 서로 동의하고 공통 요소를 써야겠다라고 합의를 본다.</li>
      <li>프로토콜도 모두 형으로 표현해야 의미가 있다.</li>
    </ul>
  </li>
</ul>

<h2 id="static-enum-class">static, enum, class</h2>

<p>jvm 에 쓸 수 있는 도용 가능한 타입 3가지</p>

<h3 id="supported-types">supported types</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">static</code> : 단 한개의 인스턴스가 존재(동시성 문제를 해결해야 함)
    <ul>
      <li><strong>Singleton</strong> 대신에 <code class="language-plaintext highlighter-rouge">static</code> 사용 (단 한개를 의미)</li>
      <li>작동이 쓰레드 동시성을 보장해주지 않기 때문에 주의해야 한다. (동시성 문제)</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">enum</code> : 제한된 수의 인스턴스가 존재(제네릭에 사용불가 없음)
    <ul>
      <li>생성시점에 동시성에 대한 <strong>안전성</strong> 이 확보되어 있다.</li>
      <li>인스턴스를 jvm이 명시된 이름으로 처음에 만들어 주기 시작하는것 외에는 클래스와 동일(제일 먼저 인스턴스화 진행)</li>
      <li>하나의 인스턴스를 만드는 경우도 사실 <code class="language-plaintext highlighter-rouge">enum</code> 으로 만드는게 더 유리</li>
      <li>제너릭에 사용할 수 없기 때문에 <strong>type(형)</strong> 을 대체하거나 유일한 <strong>type(형)</strong> 을 쓰기에는 안좋음</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">class</code>: 무제한 인스턴스가 존재
    <ul>
      <li>주력으로 사용</li>
    </ul>

    <blockquote>
      <ul>
        <li>유틸리티 함수와 메소드를 구분하는 방법<br />
utility 함수 : 클래스에 있는 메소드 내용에 <code class="language-plaintext highlighter-rouge">this</code> 가 존재하지 않으면 <strong>utility</strong>. 즉시 해당 클래스 메소드에서 제거하고 유틸리티로 나와야 한다.<br />
메소드 : <strong>this context</strong>를 사용하거나 어떠한 유지되고 있는 인스턴스의 사용 범위에 대한 라이프 사이클을 가지고 있다면 메소드</li>
      </ul>
    </blockquote>
  </li>
</ul>

<h2 id="condition">Condition</h2>
<p>상태에 대한 조건</p>

<ol>
  <li>조건 분기는 결코 제거할 수 없음
    <blockquote>
      <p>사람의 머리로는 분기에 약하기 때문에 1단계 조건문만 감당이 가능하다.
(2단계 조건 부터는 판별하기 어려움)</p>
    </blockquote>
  </li>
  <li>조건 분기에 대한 전략 두 가지
    <ul>
      <li>내부에서 응집성있게 모아두는 방식 (함수 안에서 if)<br />
 장점 : 모든 경우의 수를 한 곳에서 파악할 수 있다.<br />
 단점 : 분기가 늘어날 때마다 코드가 변형된다.
        <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kt">void</span> <span class="nf">processCondition</span><span class="o">(</span><span class="nc">String</span> <span class="n">condition</span><span class="o">)</span> <span class="o">{</span>
     <span class="k">if</span> <span class="o">(</span><span class="n">condition</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"a"</span><span class="o">))</span> <span class="o">{</span>
         <span class="n">a</span><span class="o">();</span>
     <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">condition</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"b"</span><span class="o">))</span> <span class="o">{</span>
         <span class="n">b</span><span class="o">();</span>
     <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">condition</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"c"</span><span class="o">))</span> <span class="o">{</span>
         <span class="n">c</span><span class="o">();</span>
     <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">condition</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"d"</span><span class="o">))</span> <span class="o">{</span>
         <span class="n">d</span><span class="o">();</span>
     <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">condition</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"e"</span><span class="o">))</span> <span class="o">{</span>
         <span class="n">e</span><span class="o">();</span>
     <span class="o">}</span>
 <span class="o">}</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ol>

<ul>
  <li>
    <p>외부에 분기를 위임하고 경우의 수 만큼 처리기를 만드는 방식 (함수 바깥쪽 if, 외부에서 router가 조건 처리)<br />
이 책의 내용이나 디자인 패턴에서 나오는 내용은 모두 이 방식을 구현하는 내용이다. 이 방식을 토대로 전략 패턴, 상태 패턴 같은 디자인 패턴이 존재한다.<br />
장점 : 분기가 늘어날 때마다 처리기만 추가하면 된다.<br />
단점 : 모든 경우의 수를 파악할 수 없다. ex) 개발한 사이트의 모든 url을 파악하기 힘듦</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">main</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">v</span> <span class="o">=</span> <span class="s">"c"</span><span class="o">;</span>
        <span class="nc">Runnable</span> <span class="n">run</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"a"</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"a"</span><span class="o">);}};</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"b"</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"b"</span><span class="o">);}};</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"c"</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"c"</span><span class="o">);}};</span>
        <span class="o">}</span>
        <span class="n">processCondition</span><span class="o">(</span><span class="n">run</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="kt">void</span> <span class="nf">processCondition</span><span class="o">(</span><span class="nc">Runnable</span> <span class="n">condition</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">condition</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="responsibility-driven-책임-주도">Responsibility Driven (책임 주도)</h2>

<p>여기서 말하는 책임은 인터페이스나 추상클래스가 아니라 알고리즘 코드가 들어있는 함수(working 함수)를 의미</p>

<h3 id="value--responsibility">value = responsibility</h3>
<ul>
  <li>시스템의 존재 가치는 사용자에게 제공되는 기능
    <ul>
      <li>ex) 정보가 있으면 무언가를 할 수 있다는 것이 그 시스템의 가치</li>
    </ul>
  </li>
  <li>사용자가 사용할 기능 = 시스템의 책임
    <ul>
      <li>사용자가 사용하고 싶은 기능이 그 시스템이 책임지고 수행해야 될 일<br />
ex) 영화 예매 사이트에 접속했는데 예매가 안되면 가치는 전혀 없다. 사이트의 가치를 보존하려면 예매가 잘 되야 한다.</li>
    </ul>
  </li>
  <li>시스템 차원의 책임을 더 작은 단위의 책임으로 분할
    <ul>
      <li>우리는 머리가 나쁘니까 방대한 책임을 이해할 수 없다. 그러므로 작은 책임으로 계속 <strong>분할</strong> 해야 한다.</li>
      <li>역할 모델의 핵심은 큰 책임을 <strong>응집성이 높으면서도 결합도가 낮은 부분</strong> 으로 쪼갤 수 있는지가 실력이고 이걸 달성하는데 굉장히 오래 걸린다. (1회차에서 언급한 3~5년 또는 평생)</li>
    </ul>
  </li>
  <li>해당 책임의 추상화하여 역할을 정의함
    <ul>
      <li><strong>역할</strong> 이란, 책임은 기능이지만 책임간의 공통점을 모아서 보다 높은 단계로 이해하는 과정을 의미</li>
      <li>책임과 역할을 따로 생각하는 것이 어렵다.</li>
      <li>다양한 책임으로부터 공통된 점을 뽑아서 역할로 정의하는 것이 어렵다.</li>
      <li>책임으로부터 역할을 인식하고, 반대로 역할로부터 책임을 양산할 수 있다.</li>
      <li>처리기를 역할로 묶을 수 있기 때문에 유리해질 수 있다.</li>
    </ul>
  </li>
  <li>역할에 따라 협력이 정의됨
    <ul>
      <li>협력 단계를 섣불리 책임 단계에서 정리하면 안된다.(책임 단계에서 협력을 구상하면 책임이 추가될 때, 협력 관계가 깨지게 됨)
        <blockquote>
          <p>협력 : 시스템의 어떤 기능을 구현하기 위해 객체들 사이에 이뤄지는 상호작용</p>
        </blockquote>
      </li>
    </ul>
  </li>
</ul>

<h2 id="실습-theater-with-reservation">실습 Theater with Reservation</h2>
<figure>
    <a href="/images/study/code-spitz/theater-dependency-refactor.jpg">
        <img src="/images/study/code-spitz/theater-dependency-refactor.jpg" data-rjs="/images/study/code-spitz/theater-dependency-refactor.jpg" class="zooming" alt="theater-dependency-refactor" />
    </a>
    
    <figcaption>
        theater-dependency-refactor
        
    </figcaption>
    
</figure>

<p>이전 시간 모델</p>

<figure>
    <a href="/images/study/code-spitz/theater-dependency-add-movie.jpg">
        <img src="/images/study/code-spitz/theater-dependency-add-movie.jpg" data-rjs="/images/study/code-spitz/theater-dependency-add-movie.jpg" class="zooming" alt="theater-dependency-add-movie" />
    </a>
    
    <figcaption>
        theater-dependency-add-movie
        
    </figcaption>
    
</figure>

<ul>
  <li>이 책에서는 <code class="language-plaintext highlighter-rouge">Screening</code>이 적당한 전문가라고 소개(<strong>expert pattern</strong>)
    <blockquote>
      <p>전문가 패턴(expert pattern) : 자신의 정보를 외부에 보여주지 않고 자신의 정보만 가지고 처리할 수 있는 일을 받도록 하는 패턴<br />
어떤 책임을 누가 질 것이냐를 판단할 때 정보 전문가 information expert 한테 그 책임을 부여하는게 제일 낫다.<br />
장점 : 최대한 자기 상태의 외부에 노출하지 않으면서 일을 수행할 수 있다. (객체의 특성, 캡슐화를 최대한 깨지 않기 위함) <br />
단점 : 실제로 정보 전문가라고 해서 그 책임을 수용하지 않느다. 그래서 도메인을 그냥 옮기는 것과 다른 양상으로 옮겨진다. (실제로 작성해보면 잘 안됨. ex.실제로 screening 이 reservation 을 하나?)</p>
    </blockquote>
  </li>
  <li><code class="language-plaintext highlighter-rouge">Movie</code> 객체를 추가하여 자세히 연구</li>
  <li>인터넷 예약으로 진행하도록 변경 되어 초대권 제거, <code class="language-plaintext highlighter-rouge">Reservation</code> 추가</li>
  <li><code class="language-plaintext highlighter-rouge">Theater</code>가 예약 허가
    <blockquote>
      <p>책의 코드는 movie는 객체간에 분리해야 될 일을 movie의 속성으로 처리하고 있는데 좋지 않은 예제이다.
4장까지의 movie class로써는 DiscountPolicy 가 하나만 추가되도 굉장히 많은 부분을 수정해야 된다.</p>
    </blockquote>
  </li>
</ul>

<p>1회차에서 언급했듯이 client code 부터 작성해본다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Theater</span> <span class="n">theater</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Theater</span><span class="o">(</span><span class="nc">Money</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mf">100.0</span><span class="o">));</span>
<span class="nc">Movie</span><span class="o">&lt;</span><span class="nc">AmountDiscount</span><span class="o">&gt;</span> <span class="n">movie</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Movie</span><span class="o">&lt;</span><span class="nc">AmountDiscount</span><span class="o">&gt;(</span>
        <span class="s">"spidermain"</span><span class="o">,</span>
        <span class="nc">Duration</span><span class="o">.</span><span class="na">ofMinutes</span><span class="o">(</span><span class="mi">120L</span><span class="o">),</span>
        <span class="nc">Money</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mf">5000.0</span><span class="o">),</span>
        <span class="k">new</span> <span class="nf">SequenceAmountDiscount</span><span class="o">(</span><span class="nc">Money</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mf">1000.0</span><span class="o">),</span> <span class="mi">1</span><span class="o">)</span>
<span class="o">);</span>

<span class="n">theater</span><span class="o">.</span><span class="na">addMovie</span><span class="o">(</span><span class="n">movie</span><span class="o">);</span>

<span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">day</span> <span class="o">=</span> <span class="mi">7</span><span class="o">;</span> <span class="n">day</span> <span class="o">&lt;</span> <span class="mi">32</span><span class="o">;</span> <span class="n">day</span><span class="o">++)</span> <span class="o">{</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">hour</span> <span class="o">=</span> <span class="mi">10</span><span class="o">,</span> <span class="n">seq</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">hour</span> <span class="o">&lt;</span> <span class="mi">24</span><span class="o">;</span> <span class="n">hour</span> <span class="o">+=</span> <span class="mi">3</span><span class="o">,</span> <span class="n">seq</span><span class="o">++)</span> <span class="o">{</span>
        <span class="n">theater</span><span class="o">.</span><span class="na">addScreening</span><span class="o">(</span>
                <span class="n">movie</span><span class="o">,</span>
                <span class="k">new</span> <span class="nf">Screening</span><span class="o">(</span>
                        <span class="n">seq</span><span class="o">,</span>
                        <span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2019</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="n">day</span><span class="o">,</span> <span class="n">hour</span><span class="o">,</span> <span class="mo">00</span><span class="o">,</span> <span class="mo">00</span><span class="o">),</span>
                        <span class="mi">100</span>    <span class="c1">// 가용 가능한 좌석 수</span>
                <span class="o">)</span>
        <span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="nc">TicketOffice</span> <span class="n">ticketOffice</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TicketOffice</span><span class="o">(</span><span class="nc">Money</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mf">0.0</span><span class="o">));</span>
<span class="n">theater</span><span class="o">.</span><span class="na">contractTicketOffice</span><span class="o">(</span><span class="n">ticketOffice</span><span class="o">,</span> <span class="mf">10.0</span><span class="o">);</span> <span class="c1">// 10% 급여를 지급</span>
<span class="nc">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Customer</span><span class="o">(</span><span class="nc">Money</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mf">0.0</span><span class="o">));</span>

<span class="nc">TicketSeller</span> <span class="n">seller</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TicketSeller</span><span class="o">();</span>
<span class="k">for</span><span class="o">(</span><span class="nc">Screening</span> <span class="nl">screening:</span> <span class="n">theater</span><span class="o">.</span><span class="na">getScreening</span><span class="o">(</span><span class="n">movie</span><span class="o">)){</span>
    <span class="n">customer</span><span class="o">.</span><span class="na">reserve</span><span class="o">(</span><span class="n">seller</span><span class="o">,</span> <span class="n">theater</span><span class="o">,</span> <span class="n">movie</span><span class="o">,</span> <span class="n">screening</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
    <span class="kt">boolean</span> <span class="n">isOk</span> <span class="o">=</span> <span class="n">theater</span><span class="o">.</span><span class="na">enter</span><span class="o">(</span><span class="n">customer</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">isOk</span><span class="o">);</span>
    <span class="k">break</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>작성한 <strong>시나리오</strong> 대로 잘 작동하는지 확인을 하며 이 내용을 토대로 설계 회의를 진행해도 충분.</li>
  <li>인스턴스들이 어떤 <strong>활동</strong> 을 하는지가 중요</li>
  <li>여기서 값으로 넘긴 값들도 원래 객체로 주어져야 하지만<br />
코드에서 값으로 인자를 받는 곳에서 그 값은 책임이나 역할을 수행하지 않는 다는것을 확신한 것이다.</li>
</ul>

<h3 id="discount-type">Discount Type</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">interface</span> <span class="nc">DiscountCondition</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isSatisfiedBy</span><span class="o">(</span><span class="nc">Screening</span> <span class="n">screening</span><span class="o">,</span> <span class="kt">int</span> <span class="n">audienceCount</span><span class="o">);</span>  <span class="c1">// 조건</span>
    <span class="kd">public</span> <span class="nc">Money</span> <span class="nf">calculateFee</span><span class="o">(</span><span class="nc">Money</span> <span class="n">fee</span><span class="o">);</span>  <span class="c1">// 액션</span>
<span class="o">}</span>

</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">DiscountCondition</code>은 추상화된 개념에서 보면 액터에 해당된다. 
액션을 할 객체들은 보통 <strong>발동 트리거</strong> 를 가지고 있고 <strong>트리거</strong> 가 만족하면 액션을 취한다.<br />
여기서 <code class="language-plaintext highlighter-rouge">DiscountCondition</code>는 자율적이지 않고 외부에 위탁을 하는데 (<code class="language-plaintext highlighter-rouge">lazy</code> 하게 만들기 위함. ex) <code class="language-plaintext highlighter-rouge">iterator</code>) 
준비가 되어있다는 것을 알리기 위한 <code class="language-plaintext highlighter-rouge">isSatisfiedBy</code>(<code class="language-plaintext highlighter-rouge">interface</code>)와 액션을 위한 <code class="language-plaintext highlighter-rouge">calculateFee</code>(<code class="language-plaintext highlighter-rouge">interface</code>) 둘 다 가지고 있다. 
이런 객체들은 수동적 객체이다.</p>

<p>이러한 액터의 역할은 두 개의 책임이니까 분리가 가능하다. 
<code class="language-plaintext highlighter-rouge">interface</code> 정의할 때, 인터페이스가 두 개이상의 메소드를 가지면 해체 분할 비용이 발생하게 되는데
원래 <code class="language-plaintext highlighter-rouge">interface</code> 를 정의하려면 메소드를 한 개만 정의하는 게 기본이다.
세상에서 가장 좋은 <code class="language-plaintext highlighter-rouge">interface</code> 는 메소드가 존재하지 않는 인터페이스이다. (마커 인터페이스 ex) <code class="language-plaintext highlighter-rouge">Serializable</code>, <code class="language-plaintext highlighter-rouge">Cloneable</code>)</p>

<blockquote>
  <p>가장 좋은 함수는 인자 없는 함수.(dependency가 없으니까 결합이 약해지므로 좋다.) =&gt; 프로시저</p>
</blockquote>

<p>진정한 역할은 역할 자체만 나타낼뿐이지 어떻게 해야할지를 정의하지 않아야 한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">interface</span> <span class="nc">DiscountPolicy</span> <span class="o">{</span>
    <span class="kd">interface</span> <span class="nc">AMOUNT</span> <span class="kd">extends</span> <span class="nc">DiscountPolicy</span><span class="o">{}</span>
    <span class="kd">interface</span> <span class="nc">PERCENT</span> <span class="kd">extends</span> <span class="nc">DiscountPolicy</span><span class="o">{}</span>
    <span class="kd">interface</span> <span class="nc">COUNT</span> <span class="kd">extends</span> <span class="nc">DiscountPolicy</span><span class="o">{}</span>
    <span class="kd">interface</span> <span class="nc">NONE</span> <span class="kd">extends</span> <span class="nc">DiscountPolicy</span><span class="o">{}</span>
<span class="o">}</span>

</code></pre></div></div>

<p>여기서 Policy는 마커인터페이스이다.</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">enum</code> 으로 정의하고 싶지만 <code class="language-plaintext highlighter-rouge">emum</code> 은 <code class="language-plaintext highlighter-rouge">Generic</code> 에서 <strong>type</strong> 이 될 수 없어서 <code class="language-plaintext highlighter-rouge">interface</code> 로 정의</li>
  <li>DiscountCondition 가 메소드를 두 개 가지고 있으므로 <code class="language-plaintext highlighter-rouge">Policy</code>를 이용해서 공략한다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">abstract</span> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SequenceDiscount</span> <span class="kd">implements</span> <span class="nc">DiscountCondition</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">sequence</span><span class="o">;</span>

    <span class="nc">SequenceDiscount</span><span class="o">(</span><span class="kt">int</span> <span class="n">sequence</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">sequence</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isSatisfiedBy</span><span class="o">(</span><span class="nc">Screening</span> <span class="n">screening</span><span class="o">,</span> <span class="kt">int</span> <span class="n">audienceCount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">screening</span><span class="o">.</span><span class="na">sequence</span> <span class="o">==</span> <span class="n">sequence</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">SequenceDiscount</code>는 <code class="language-plaintext highlighter-rouge">sequence</code>에 대한 처리를 위한 것이고</li>
  <li><code class="language-plaintext highlighter-rouge">SequenceDiscount</code>를 상속받는 것은 어떤 할인을 취할 것인가에 대한 액션 구현</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SequenceAmountDiscount</span> <span class="kd">extends</span> <span class="nc">SequenceDiscount</span> <span class="kd">implements</span> <span class="nc">DiscountPolicy</span><span class="o">.</span><span class="na">AMOUNT</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Money</span> <span class="n">amount</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">SequenceAmountDiscount</span><span class="o">(</span><span class="kt">int</span> <span class="n">sequence</span><span class="o">,</span> <span class="nc">Money</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">sequence</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">amount</span> <span class="o">=</span> <span class="n">amount</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Money</span> <span class="nf">calculateFee</span><span class="o">(</span><span class="nc">Money</span> <span class="n">fee</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">fee</span><span class="o">.</span><span class="na">minus</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SequencePercentDiscount</span> <span class="kd">extends</span> <span class="nc">SequenceDiscount</span> <span class="kd">implements</span> <span class="nc">DiscountPolicy</span><span class="o">.</span><span class="na">PERCENT</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">double</span> <span class="n">percent</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">SequencePercenttDiscount</span><span class="o">(</span><span class="kt">int</span> <span class="n">sequence</span><span class="o">,</span> <span class="kt">double</span> <span class="n">percent</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">sequence</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">percent</span> <span class="o">=</span> <span class="n">percent</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Money</span> <span class="nf">calculateFee</span><span class="o">(</span><span class="nc">Money</span> <span class="n">fee</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">fee</span><span class="o">.</span><span class="na">minus</span><span class="o">(</span><span class="n">fee</span><span class="o">.</span><span class="na">multi</span><span class="o">(</span><span class="n">percent</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>



</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">SequenceDiscount</code>를 상속받은 클래스는 <code class="language-plaintext highlighter-rouge">sequence</code> 대한 처리는 부모한테 맡기고 
<code class="language-plaintext highlighter-rouge">amount</code> 또는 <code class="language-plaintext highlighter-rouge">percent</code> 기반으로 <code class="language-plaintext highlighter-rouge">calculateFee</code>만 구현하면 된다.<br />
이 추상화를 통해 공통 부모가 <code class="language-plaintext highlighter-rouge">SequenceDiscount</code> 가 되는데 여기서 <code class="language-plaintext highlighter-rouge">movie</code>는 <code class="language-plaintext highlighter-rouge">discount</code>에 대한 <code class="language-plaintext highlighter-rouge">policy</code>가 한가지 인 것을 요구하고 있다.
즉, <code class="language-plaintext highlighter-rouge">SequenceDiscount</code>의 대표 타입이 <code class="language-plaintext highlighter-rouge">DiscountPolicy</code> 가 되길 원했지만 여기서 <code class="language-plaintext highlighter-rouge">DiscountCondition</code> 이 대표타입으로 된 것이다.
<code class="language-plaintext highlighter-rouge">SequenceDiscount</code> 는 <code class="language-plaintext highlighter-rouge">DiscountCondition</code> 으로 묶인 것이지 <code class="language-plaintext highlighter-rouge">DiscountPolicy</code> 는 기준으로는 다른 클래스가 가지게 된 것이다.
이러한 점이 우리가 생각한 도메인과 맞지 않는다. 따라서 <code class="language-plaintext highlighter-rouge">SequenceDiscount</code>을 추상층으로 묶으면 안된다.</p>

<p>그래서 코드는 다음과 같이 변경된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kn">package</span> <span class="nn">theater</span><span class="o">;</span>

<span class="kd">abstract</span> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">AmountDiscount</span> <span class="kd">implements</span> <span class="nc">DiscountPolicy</span><span class="o">.</span><span class="na">AMOUNT</span><span class="o">,</span> <span class="nc">DiscountCondition</span><span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Money</span> <span class="n">amount</span><span class="o">;</span>

    <span class="nc">AmountDiscount</span><span class="o">(</span><span class="nc">Money</span> <span class="n">amount</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">amount</span> <span class="o">=</span> <span class="n">amount</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Money</span> <span class="nf">calculateFee</span><span class="o">(</span><span class="nc">Money</span> <span class="n">fee</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">fee</span><span class="o">.</span><span class="na">minus</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">PercentDiscount</span> <span class="kd">implements</span> <span class="nc">DiscountPolicy</span><span class="o">.</span><span class="na">PERCENT</span><span class="o">,</span> <span class="nc">DiscountCondition</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">double</span> <span class="n">percent</span><span class="o">;</span>

    <span class="nc">PercentDiscount</span><span class="o">(</span><span class="kt">double</span> <span class="n">percent</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">percent</span> <span class="o">=</span> <span class="n">percent</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Money</span> <span class="nf">calculateFee</span><span class="o">(</span><span class="nc">Money</span> <span class="n">fee</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">fee</span><span class="o">.</span><span class="na">minus</span><span class="o">(</span><span class="n">fee</span><span class="o">.</span><span class="na">multi</span><span class="o">(</span><span class="n">percent</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>


</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SequenceAmountDiscount</span> <span class="kd">extends</span> <span class="nc">AmountDiscount</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">sequence</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">SequenceAmountDiscount</span><span class="o">(</span><span class="nc">Money</span> <span class="n">amount</span><span class="o">,</span> <span class="kt">int</span> <span class="n">sequence</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">sequence</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isSatisfiedBy</span><span class="o">(</span><span class="nc">Screening</span> <span class="n">screening</span><span class="o">,</span> <span class="kt">int</span> <span class="n">audienceCount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">screening</span><span class="o">.</span><span class="na">sequence</span> <span class="o">==</span> <span class="n">sequence</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SequencePercentDiscount</span> <span class="kd">extends</span> <span class="nc">PercentDiscount</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">sequence</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">SequencePercentDiscount</span><span class="o">(</span><span class="kt">double</span> <span class="n">percent</span><span class="o">,</span> <span class="kt">int</span> <span class="n">sequence</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">percent</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">sequence</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isSatisfiedBy</span><span class="o">(</span><span class="nc">Screening</span> <span class="n">screening</span><span class="o">,</span> <span class="kt">int</span> <span class="n">audienceCount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">screening</span><span class="o">.</span><span class="na">sequence</span> <span class="o">==</span> <span class="n">sequence</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>


</code></pre></div></div>

<p>이렇게 되면 우리가 원하는 <code class="language-plaintext highlighter-rouge">Movie</code>에 사용할 수 있는 특정 <code class="language-plaintext highlighter-rouge">Policy</code>를 따르는 <code class="language-plaintext highlighter-rouge">Discount</code>의 형태로 된다.
이제 하위 클래스에서 <code class="language-plaintext highlighter-rouge">Sequence</code> 에 대한 처리만 구현만 하면 된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Movie</span><span class="o">&lt;</span><span class="no">T</span> <span class="kd">extends</span> <span class="nc">DiscountPolicy</span> <span class="o">&amp;</span> <span class="nc">DiscountCondition</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Duration</span> <span class="n">runningTime</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Money</span> <span class="n">fee</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">discountConditions</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;&gt;();</span>


    <span class="kd">public</span> <span class="nf">Movie</span><span class="o">(</span><span class="nc">String</span> <span class="n">title</span><span class="o">,</span> <span class="nc">Duration</span> <span class="n">runningTime</span><span class="o">,</span> <span class="nc">Money</span> <span class="n">fee</span><span class="o">,</span> <span class="no">T</span><span class="o">...</span> <span class="n">conditions</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">runningTime</span> <span class="o">=</span> <span class="n">runningTime</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">fee</span> <span class="o">=</span> <span class="n">fee</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">discountConditions</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">conditions</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="nc">Money</span> <span class="nf">calculateFee</span><span class="o">(</span><span class="nc">Screening</span> <span class="n">screening</span><span class="o">,</span> <span class="kt">int</span> <span class="n">audienceCount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="no">T</span> <span class="n">condition</span> <span class="o">:</span> <span class="n">discountConditions</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">condition</span><span class="o">.</span><span class="na">isSatisfiedBy</span><span class="o">(</span><span class="n">screening</span><span class="o">,</span> <span class="n">audienceCount</span><span class="o">))</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">condition</span><span class="o">.</span><span class="na">calculateFee</span><span class="o">(</span><span class="n">fee</span><span class="o">).</span><span class="na">multi</span><span class="o">((</span><span class="kt">double</span><span class="o">)</span> <span class="n">audienceCount</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">fee</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>


</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Movie</code>는 <code class="language-plaintext highlighter-rouge">DiscountPolicy</code> 와 <code class="language-plaintext highlighter-rouge">DiscountCondition</code> 동시에 만족하는 하위 객체 <code class="language-plaintext highlighter-rouge">T</code>(<code class="language-plaintext highlighter-rouge">AmountDiscount</code> 또는 <code class="language-plaintext highlighter-rouge">PercentDiscount</code>)만 제너릭 타입을 선언할 수 있다.
<code class="language-plaintext highlighter-rouge">if</code>를 제거하는 유일한 방법 중에 하나는 바깥쪽에 <code class="language-plaintext highlighter-rouge">if</code>를 위임하고 맞는 객체를 만들어내는 것인데 이 처리를 위와 같이 <strong>type(형)</strong> 으로 대체할 수 있다.(<code class="language-plaintext highlighter-rouge">Generic</code>을 통한 <code class="language-plaintext highlighter-rouge">if</code>문 제거)
결국, <code class="language-plaintext highlighter-rouge">Generic</code>은 컴파일러가 제공해주는 타입을 이용한 라우터 역할을 해주는 것이다.</p>

<p>위 코드에서 discountConditions의 필드 타입을 <code class="language-plaintext highlighter-rouge">Set</code> 으로 선언했다.
<code class="language-plaintext highlighter-rouge">List</code> 를 사용한다는 것은 값 컨텍스트를 사용하고 싶다는 의미이기 때문이다. 
Container에 값으로 식별할 생각이 없었다면 자연스럽게 <code class="language-plaintext highlighter-rouge">Set</code> 을 사용하게 된다.
객체 식별자로 구분이 된다고 생각했다면 <code class="language-plaintext highlighter-rouge">Set</code> 을 쓸 수 밖에 없다.
객체 지향이라면 <code class="language-plaintext highlighter-rouge">Set</code> 을 사용하는 것이 자연스러운 것이다.</p>

<h3 id="value-object">Value Object</h3>

<p>값 객체는 <strong>불변</strong> 과 값이 변할 때마다 <strong>새 객체를 반환</strong> 하는 두가지 특성이 존재한다.</p>

<p>1.불변</p>
<ul>
  <li>모든 <code class="language-plaintext highlighter-rouge">field</code>가 <code class="language-plaintext highlighter-rouge">final</code>(불변) 이어야 한다.</li>
</ul>

<p>2.새 객체 반환</p>
<ul>
  <li>값을 갱신할 수 없어서 갱신된 값을 갖는 새 객체를 반환</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Money</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Money</span> <span class="nf">of</span><span class="o">(</span><span class="nc">Double</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Money</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Double</span> <span class="n">amount</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Money</span><span class="o">(</span><span class="nc">Double</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">amount</span> <span class="o">=</span> <span class="n">amount</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Money</span> <span class="nf">minus</span><span class="o">(</span><span class="nc">Money</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Money</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">amount</span> <span class="o">&gt;</span> <span class="n">amount</span><span class="o">.</span><span class="na">amount</span> <span class="o">?</span> <span class="k">this</span><span class="o">.</span><span class="na">amount</span> <span class="o">-</span> <span class="n">amount</span><span class="o">.</span><span class="na">amount</span> <span class="o">:</span> <span class="mf">0.0</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Money</span> <span class="nf">plus</span><span class="o">(</span><span class="nc">Money</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Money</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">amount</span> <span class="o">+</span> <span class="n">amount</span><span class="o">.</span><span class="na">amount</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Money</span> <span class="nf">multi</span><span class="o">(</span><span class="nc">Double</span> <span class="n">times</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Money</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">amount</span> <span class="o">*</span> <span class="n">times</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">greaterThen</span><span class="o">(</span><span class="nc">Money</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">amount</span> <span class="o">&gt;=</span> <span class="n">amount</span><span class="o">.</span><span class="na">amount</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h4 id="reservation--etc">reservation &amp; etc…</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Reservation</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Reservation</span> <span class="no">NONE</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Reservation</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span> <span class="c1">// 이펙티브 자바</span>

    <span class="kd">final</span> <span class="nc">Theater</span> <span class="n">theater</span><span class="o">;</span>
    <span class="kd">final</span> <span class="nc">Movie</span> <span class="n">movie</span><span class="o">;</span>
    <span class="kd">final</span> <span class="nc">Screening</span> <span class="n">screening</span><span class="o">;</span>
    <span class="kd">final</span> <span class="kt">int</span> <span class="n">count</span><span class="o">;</span>

    <span class="nc">Reservation</span><span class="o">(</span><span class="nc">Theater</span> <span class="n">theater</span><span class="o">,</span> <span class="nc">Movie</span> <span class="n">movie</span><span class="o">,</span> <span class="nc">Screening</span> <span class="n">screening</span><span class="o">,</span> <span class="kt">int</span> <span class="n">audienceCount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">theater</span> <span class="o">=</span> <span class="n">theater</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">movie</span> <span class="o">=</span> <span class="n">movie</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">screening</span> <span class="o">=</span> <span class="n">screening</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">count</span> <span class="o">=</span> <span class="n">audienceCount</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Screening</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">seat</span><span class="o">;</span>
    <span class="kd">final</span> <span class="kt">int</span> <span class="n">sequence</span><span class="o">;</span>
    <span class="kd">final</span> <span class="nc">LocalDateTime</span> <span class="n">whenScreened</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Screening</span><span class="o">(</span><span class="kt">int</span> <span class="n">sequence</span><span class="o">,</span> <span class="nc">LocalDateTime</span> <span class="n">when</span><span class="o">,</span> <span class="kt">int</span> <span class="n">seat</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">sequence</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">whenScreened</span> <span class="o">=</span> <span class="n">when</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">seat</span> <span class="o">=</span> <span class="n">seat</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kt">boolean</span> <span class="nf">hasSeat</span><span class="o">(</span><span class="kt">int</span> <span class="n">count</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">seat</span> <span class="o">&gt;=</span> <span class="n">count</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kt">void</span> <span class="nf">reserveSeat</span><span class="o">(</span><span class="kt">int</span> <span class="n">count</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">hasSeat</span><span class="o">(</span><span class="n">count</span><span class="o">))</span> <span class="n">seat</span> <span class="o">-=</span> <span class="n">count</span><span class="o">;</span>
        <span class="k">else</span> <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"no seat"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">class</span> <span class="nc">Theater</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Screening</span><span class="o">&gt;</span> <span class="no">EMPTY</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;&gt;();</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">TicketOffice</span><span class="o">&gt;</span> <span class="n">ticketOffices</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;&gt;();</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Movie</span><span class="o">,</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Screening</span><span class="o">&gt;&gt;</span> <span class="n">movies</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
    <span class="kd">private</span> <span class="nc">Money</span> <span class="n">amount</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Theater</span><span class="o">(</span><span class="nc">Money</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">amount</span> <span class="o">=</span> <span class="n">amount</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">addMovie</span><span class="o">(</span><span class="nc">Movie</span> <span class="n">movie</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">movies</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">movie</span><span class="o">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">movies</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">movie</span><span class="o">,</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;&gt;());</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">addScreening</span><span class="o">(</span><span class="nc">Movie</span> <span class="n">movie</span><span class="o">,</span> <span class="nc">Screening</span> <span class="n">screening</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">movies</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">movie</span><span class="o">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">movies</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">movie</span><span class="o">).</span><span class="na">add</span><span class="o">(</span><span class="n">screening</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">contractTicketOffice</span><span class="o">(</span><span class="nc">TicketOffice</span> <span class="n">ticketOffice</span><span class="o">,</span> <span class="nc">Double</span> <span class="n">rate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">ticketOffice</span><span class="o">.</span><span class="na">contract</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">rate</span><span class="o">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">ticketOffices</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">ticketOffice</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">cancelTicketOffice</span><span class="o">(</span><span class="nc">TicketOffice</span> <span class="n">ticketOffice</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">ticketOffices</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">ticketOffice</span><span class="o">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">ticketOffice</span><span class="o">.</span><span class="na">cancel</span><span class="o">(</span><span class="k">this</span><span class="o">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">ticketOffices</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">ticketOffice</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kt">void</span> <span class="nf">plusAmount</span><span class="o">(</span><span class="nc">Money</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">amount</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">amount</span><span class="o">.</span><span class="na">plus</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Screening</span><span class="o">&gt;</span> <span class="nf">getScreening</span><span class="o">(</span><span class="nc">Movie</span> <span class="n">movie</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">movies</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">movie</span><span class="o">)</span> <span class="o">||</span> <span class="k">this</span><span class="o">.</span><span class="na">movies</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">movie</span><span class="o">).</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="k">return</span> <span class="no">EMPTY</span><span class="o">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">movies</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">movie</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kt">boolean</span> <span class="nf">isValidScreening</span><span class="o">(</span><span class="nc">Movie</span> <span class="n">movie</span><span class="o">,</span> <span class="nc">Screening</span> <span class="n">screening</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">movies</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">movie</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">movies</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">movie</span><span class="o">).</span><span class="na">contains</span><span class="o">(</span><span class="n">screening</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">enter</span><span class="o">(</span><span class="nc">Customer</span> <span class="n">customer</span><span class="o">,</span> <span class="kt">int</span> <span class="n">count</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Reservation</span> <span class="n">reservation</span> <span class="o">=</span> <span class="n">customer</span><span class="o">.</span><span class="na">reservation</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">reservation</span> <span class="o">!=</span> <span class="nc">Reservation</span><span class="o">.</span><span class="na">NONE</span> <span class="o">&amp;&amp;</span>
                <span class="n">reservation</span><span class="o">.</span><span class="na">theater</span> <span class="o">!=</span> <span class="k">this</span> <span class="o">&amp;&amp;</span>
                <span class="n">isValidScreening</span><span class="o">(</span><span class="n">reservation</span><span class="o">.</span><span class="na">movie</span><span class="o">,</span> <span class="n">reservation</span><span class="o">.</span><span class="na">screening</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
                <span class="n">reservation</span><span class="o">.</span><span class="na">count</span> <span class="o">==</span> <span class="n">count</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nc">Reservation</span> <span class="nf">reserve</span><span class="o">(</span><span class="nc">Movie</span> <span class="n">movie</span><span class="o">,</span> <span class="nc">Screening</span> <span class="n">screening</span><span class="o">,</span> <span class="kt">int</span> <span class="n">count</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">isValidScreening</span><span class="o">(</span><span class="n">movie</span><span class="o">,</span> <span class="n">screening</span><span class="o">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">screening</span><span class="o">.</span><span class="na">hasSeat</span><span class="o">(</span><span class="n">count</span><span class="o">))</span> <span class="k">return</span> <span class="nc">Reservation</span><span class="o">.</span><span class="na">NONE</span><span class="o">;</span>
        <span class="n">screening</span><span class="o">.</span><span class="na">reserveSeat</span><span class="o">(</span><span class="n">count</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Reservation</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">movie</span><span class="o">,</span> <span class="n">screening</span><span class="o">,</span> <span class="n">count</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TicketOffice</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Money</span> <span class="n">amount</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Theater</span><span class="o">,</span> <span class="nc">Double</span><span class="o">&gt;</span> <span class="n">commissionRate</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>

    <span class="kd">public</span> <span class="nf">TicketOffice</span><span class="o">(</span><span class="nc">Money</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">amount</span> <span class="o">=</span> <span class="n">amount</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kt">boolean</span> <span class="nf">contract</span><span class="o">(</span><span class="nc">Theater</span> <span class="n">theater</span><span class="o">,</span> <span class="nc">Double</span> <span class="n">rate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">commissionRate</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">theater</span><span class="o">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">commissionRate</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">theater</span><span class="o">,</span> <span class="n">rate</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kt">boolean</span> <span class="nf">cancel</span><span class="o">(</span><span class="nc">Theater</span> <span class="n">theater</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">commissionRate</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">theater</span><span class="o">))</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="n">commissionRate</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">theater</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nc">Reservation</span> <span class="nf">reserve</span><span class="o">(</span><span class="nc">Theater</span> <span class="n">theater</span><span class="o">,</span> <span class="nc">Movie</span> <span class="n">movie</span><span class="o">,</span> <span class="nc">Screening</span> <span class="n">screening</span><span class="o">,</span> <span class="kt">int</span> <span class="n">count</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">commissionRate</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">theater</span><span class="o">)</span> <span class="o">||</span>
                <span class="o">!</span><span class="n">theater</span><span class="o">.</span><span class="na">isValidScreening</span><span class="o">(</span><span class="n">movie</span><span class="o">,</span> <span class="n">screening</span><span class="o">)</span> <span class="o">||</span>
                <span class="o">!</span><span class="n">screening</span><span class="o">.</span><span class="na">hasSeat</span><span class="o">(</span><span class="n">count</span><span class="o">)</span>
        <span class="o">)</span> <span class="k">return</span> <span class="nc">Reservation</span><span class="o">.</span><span class="na">NONE</span><span class="o">;</span>

        <span class="nc">Reservation</span> <span class="n">reservation</span> <span class="o">=</span> <span class="n">theater</span><span class="o">.</span><span class="na">reserve</span><span class="o">(</span><span class="n">movie</span><span class="o">,</span> <span class="n">screening</span><span class="o">,</span> <span class="n">count</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">reservation</span> <span class="o">!=</span> <span class="nc">Reservation</span><span class="o">.</span><span class="na">NONE</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Money</span> <span class="n">sales</span> <span class="o">=</span> <span class="n">movie</span><span class="o">.</span><span class="na">calculateFee</span><span class="o">(</span><span class="n">screening</span><span class="o">,</span> <span class="n">count</span><span class="o">);</span>
            <span class="nc">Money</span> <span class="n">commission</span> <span class="o">=</span> <span class="n">sales</span><span class="o">.</span><span class="na">multi</span><span class="o">(</span><span class="n">commissionRate</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">theater</span><span class="o">));</span>
            <span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span><span class="o">.</span><span class="na">plus</span><span class="o">(</span><span class="n">commission</span><span class="o">);</span>
            <span class="n">theater</span><span class="o">.</span><span class="na">plusAmount</span><span class="o">(</span><span class="n">sales</span><span class="o">.</span><span class="na">minus</span><span class="o">(</span><span class="n">commission</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">reservation</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TicketSeller</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">TicketOffice</span> <span class="n">ticketOffice</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTicketOffice</span><span class="o">(</span><span class="nc">TicketOffice</span> <span class="n">ticketOffice</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">ticketOffice</span> <span class="o">=</span> <span class="n">ticketOffice</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nc">Reservation</span> <span class="nf">reserve</span><span class="o">(</span><span class="nc">Customer</span> <span class="n">customer</span><span class="o">,</span> <span class="nc">Theater</span> <span class="n">theater</span><span class="o">,</span> <span class="nc">Movie</span> <span class="n">movie</span><span class="o">,</span> <span class="nc">Screening</span> <span class="n">screening</span><span class="o">,</span> <span class="kt">int</span> <span class="n">count</span><span class="o">){</span>
        <span class="nc">Reservation</span> <span class="n">reservation</span> <span class="o">=</span> <span class="nc">Reservation</span><span class="o">.</span><span class="na">NONE</span><span class="o">;</span>
        <span class="nc">Money</span> <span class="n">price</span> <span class="o">=</span> <span class="n">movie</span><span class="o">.</span><span class="na">calculateFee</span><span class="o">(</span><span class="n">screening</span><span class="o">,</span> <span class="n">count</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">customer</span><span class="o">.</span><span class="na">hasAmount</span><span class="o">(</span><span class="n">price</span><span class="o">)){</span>
            <span class="n">reservation</span> <span class="o">=</span> <span class="n">ticketOffice</span><span class="o">.</span><span class="na">reserve</span><span class="o">(</span><span class="n">theater</span><span class="o">,</span><span class="n">movie</span><span class="o">,</span><span class="n">screening</span><span class="o">,</span><span class="n">count</span><span class="o">);</span>
            <span class="k">if</span><span class="o">(</span><span class="n">reservation</span> <span class="o">!=</span> <span class="nc">Reservation</span><span class="o">.</span><span class="na">NONE</span><span class="o">)</span> <span class="n">customer</span><span class="o">.</span><span class="na">minusAmount</span><span class="o">(</span><span class="n">price</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">reservation</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Customer</span> <span class="o">{</span>
    <span class="nc">Reservation</span> <span class="n">reservation</span> <span class="o">=</span> <span class="nc">Reservation</span><span class="o">.</span><span class="na">NONE</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Money</span> <span class="n">amount</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Customer</span><span class="o">(</span><span class="nc">Money</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">amount</span> <span class="o">=</span> <span class="n">amount</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">reserve</span><span class="o">(</span><span class="nc">TicketSeller</span> <span class="n">seller</span><span class="o">,</span> <span class="nc">Theater</span> <span class="n">theater</span><span class="o">,</span> <span class="nc">Movie</span> <span class="n">movie</span><span class="o">,</span> <span class="nc">Screening</span> <span class="n">screening</span><span class="o">,</span> <span class="kt">int</span> <span class="n">count</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">reservation</span> <span class="o">=</span> <span class="n">seller</span><span class="o">.</span><span class="na">reserve</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">theater</span><span class="o">,</span> <span class="n">movie</span><span class="o">,</span> <span class="n">screening</span><span class="o">,</span> <span class="n">count</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kt">boolean</span> <span class="nf">hasAmount</span><span class="o">(</span><span class="nc">Money</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">amount</span><span class="o">.</span><span class="na">greaterThen</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kt">void</span> <span class="nf">minusAmount</span><span class="o">(</span><span class="nc">Money</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">amount</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">amount</span><span class="o">.</span><span class="na">minus</span><span class="o">(</span><span class="n">amount</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h3 id="practice">Practice</h3>

<ol>
  <li>
    <p>본 예제에서는 <code class="language-plaintext highlighter-rouge">Sequence</code>를 통한 할인조건만 구현되어 있다. 
Period 및 한번에 예약하는 사람의 수가 일정 수를 넘어가면 
할인해주는 Count 조건에 따른 할인조건을 구현하라.</p>
  </li>
  <li>
    <p>현재의 예제는 영화와 상영이라는 컨텍스트로 역할로 예매를 진행한다.
상영은 본디 시간표일 뿐이므로 좌석수 등을 갖을 수 없다.
극장이 상영관을 소유하게 하고 상영이 상영관과 협력하여 예매시의 잔여좌석수를 관리하도록 개선하라</p>
  </li>
</ol>


          </div>
          <div class="article-share">
            
            
            <a href="https://twitter.com/home?status=%EC%BD%94%EB%93%9C+%EC%8A%A4%ED%94%BC%EC%B8%A0+Object83+2%ED%9A%8C%EC%B0%A8+%EC%A0%95%EB%A6%AC%20-%20https://devyonghee.github.io/study/2019/08/19/code-spitz-object83-2/" title="Share on Twitter" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6 -18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6 0.8 15 2.5 22.1 -80.5-4-151.9-42.6-199.6-101.3 -8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 0.4 0 0.8 0 1.2 0 47 33.4 86.1 77.7 95 -8.1 2.2-16.7 3.4-25.5 3.4 -6.2 0-12.3-0.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3 -33.1 26-74.9 41.5-120.3 41.5 -7.8 0-15.5-0.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-0.1-8.4-0.3-12.5C462.6 146 479 129 492 109.5z"/></svg>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=https://devyonghee.github.io/study/2019/08/19/code-spitz-object83-2/" title="Share on Facebook" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5 0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"/></svg>
            </a>
          </div>
          
            <script src="https://utteranc.es/client.js"
                    repo="devyonghee/devyonghee.github.io"
                    issue-term="pathname"
                    theme="preferred-color-scheme"
                    crossorigin="anonymous"
                    async>
            </script>
          
        </article>
        <footer class="footer scrollappear">
  <p>
    Chalk is a high quality, completely customizable, performant and 100% free
    blog template for Jekyll built by
    <a href="/about" title="About me">Nielsen Ramon</a>. Download it <a href="https://github.com/nielsenramon/chalk" rel="noreferrer noopener" target="_blank" title="Download Chalk">here</a>.
  </p>
</footer>

      </div>
    </div>
  </main>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Q7PS3PZYZ6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-Q7PS3PZYZ6');
  </script>


  <script src="/javascripts/application.f8aad56336bbc2752062.js"></script>


  <script src="/javascripts/scrollappear.964ae3fd7af0dfd85a7e.js"></script>




  <script src="/javascripts/themetoggle.b54b8a02c0c26756418e.js"></script>

</body>
</html>
