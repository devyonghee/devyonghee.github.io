---
title: '[Modern Java in Action] Chapter10. 람다를 이용한 도메인 전용 언어'
tags: [book, moder java in action]
categories: book
---

모던 자바 인 액션 10장에서는 도메인 전용 언어(domain specific languages, DSL) 에 대해 소개하고 있다.  
DSL 이 무엇인지 알아보고 람다를 이용하여 효과적인 자바 기반 DSL 을 구현하는 방법에 대해 알아본다.


<!--more-->

<br/>

개발팀과 도메인 전문가가 이해할 수 있는 코드는 생산성과 직결되기 때문에 코드는 읽기 쉽고 이해하기 쉬워야 한다.  
도메인 전용 언어(DSL)는 특정 도메인을 대상으로 만들어진 프로그래밍 언어로 이 문제를 해결할 수 있다. (ex. 빌드 과정을 표현하는 dsl 인 메이븐, 앤트 등)


<br/>

## 10.1 도메인 전용 언어

DSL(domain specific languages)은 범용 프로그래밍 언어가 아니라 특정 비즈니스 도메인의 문제를 해결하려고 만든 언어다.  
특정 도메인에만 국한되므로 오직 자신의 문제를 어떻게 해결할지에만 집중할 수 있고 복잡성을 잘 다룰 수 있다. 

- DSL을 개발하기 위해 필요한 점
  - 의사 소통의 왕: 프로그래머가 아닌 사람도 이해할 수 있도록 코드의 의도가 명확히 전달되어야 함(코드가 비즈니스 요구사항에 부합하는지 확인 가능) 
  - 한 번 코드를 구현하지만 여러번 읽는다: 가독성은 유지보수의 핵심. 동료가 쉽게 이해할 수 있도록 코드 구현 필수 
  
### 장점 
- 간결함
  - 비즈니스 로직을 간편하게 캡슐화하므로 반복을 피하고 코드를 간결하게 만들 수 있음
- 가독성
  - 도메인 영역의 용어를 사용하므로 비 도메인 전문가도 쉽게 이해 가능
  - 조직 구성원 간에 코드와 도메인 영역이 공유될 수 있음
- 유지보수
  - 잘 설계된 DSL로 구현하면 쉽게 유지보수하고 변경 가능
- 높은 수준의 추상화
  - DSL 은 도메인과 같은 추상화 수준에서 동작하므로 도메인의 문제와 직접적으로 관련되지 않은 세부 사항을 숨김
- 집중
  - 도메인의 규칙을 표현할 목적으로 설계되었으므로 프로그래머가 특정 코드에 집중 가능 (생산성 향상)
- 관심사 분리(Separation of concerns)
  - 애플리케이션의 인프라구조와 관련된 문제와 독립적으로 비즈니스 관련된 코드에서 집중 가능 (유지보수 향상)

### 단점
- DLS 설계의 어려움
  - 간결하게 제한적인 언어에 도메인 지식을 담기 어려움
- 개발 비용
  - 코드에 DSL을 추가하는 작업은 초기 프로젝트에 많은 비용과 시간이 소모
  - DSL 유지보수와 변경은 프로젝트에 부담
- 추가 우회 계층
  - DSL은 추가적인 계층으로 도메인 모델을 감싸며 계층을 최대한 작게 만들어 성능 문제 회피
- 새로 배워야 하는 언어
  - DSL 을 프로젝트에 추가하면 배워야 하는 언어도 증가
- 호스팅 언어 한계
  - 자바 같은 범용 프로그래밍 언어는 장황하고 엄격한 문법을 가지므로 사용자 친화적 DSL 만들기 어려움 (람다 표현식으로 어느정도 해결)

### 내부 DSL 

순수 자바코드 같은 기존 호스팅 언어를 기반으로 구현한 DSL  
유연성이 떨어지기 때문에 간단하고 표현력 있는 DSL을 만드는데 한계가 있었지만 람다 표현식이 등장하면서 어느정도 해결될 수 있음  
순수 자바로 DSL 을 구현하면 다음과 같은 장점이 존재한다.  

- 외부 DSL에 비해 새로운 패턴과 기술을 배워 DSL을 구현하는 노력이 감소
- 순수 자바로 DSL 을 구현하면 나머지 코드와 함께 컴파일 가능. (다른 언어의 컴파일러 또는 외부 DSL을 만드는 도구를 사용하지 않아도 됨)
- 새로운 언어를 배우거나 복잡한 외부 도구를 배울 필요가 없음
- DSL 사용자는 기존의 자바 IDE로 자동 완성, 리팩터링 기능 그대로 사용 가능
- 추가 DSL을 쉽게 합칠 수 있음

### 다중 DSL

자바는 아니지만 JVM에서 실행되며 더 유연하고 표현력이 가능한 언어(ex. 스칼라, 그루비...)로 구현한 DSL  
코틀린, 실론 같이 스칼라와 호환성이 유지되며 단순하고 쉽게 배울 수 있는 새 언어도 존재한다.  
이 언어들은 모두 자바보다 젋으며 제약을 줄이고, 간편한 문법을 지향하도록 설계되었다.  
DSL 친화적이지만 다음과 같은 단점들이 존재한다.

- 새로운 프로그래밍 언어를 배우거나 누군가 해당 기술을 지니고 있어야 함
- 두 개 이상의 언어가 혼재하므로 여러 컴파일러로 소스를 빌드하도록 빌드 과정을 개선해야 함
- JVM 에서 실행되지만 자바와 호환성이 완벽하지 않은 경우가 많음 (성능 손실 가능)

### 외부 DSL

스탠드어론(standalone) 이라고 불리우며 호스팅 언어와는 독립적으로 자체의 문법을 가지는 DSL  
자신만의 문법과 구문으로 새 언어를 설계해야 하고 언어 파싱, 파서의 결과 분석, 외부 DSL 실행할 코드를 만들어야 함  
이 방법을 선택해야 한다면 ANTLR 같은 자바 기반 파서 생성기를 이용하면 도움을 받을 수 있음

- 장점
  - 무한한 유연성을 가짐
  - 필요한 특성을 완벽하게 제공하는 언어로 설계 가능
  - 비즈니스 문제를 묘사하고 해결하는 가독성 좋은 언어 선택 가능
  - 자바로 개발된 인프라구조 코드와 비즈니스 코드를 명확하게 분리 가능
- 단점
  - 일반적인 작업이 아니며 쉽게 기술을 얻을 수 없음
  - 작업이 복잡하고 제어 범위를 쉽게 벗어날 수 있음
  - 처음 설계한 목적을 벗어나는 경우가 많음
  - DSL과 호스트 언어 사이에 인공 계층이 생김
  

