---
title: 이펙티브 자바 Chapter8. 메서드
tags: [book, effective-java]
categories: book
---


이펙티브 자바 8장에서는 메서드 매개변수, 반환값, 시그니처 설계 등  
메서드를 설계할 때 고려해야 할 점들에 대해 소개한다.

<!--more-->

<br/>

## 아이템 49. 매개변수가 유효한지 검사하라

매개변수들의 제약을 고려하고 명시적으로 검사하는 습관을 기르자

### 메서드가 몸체가 **시작되기 전**에 매개변수 제약(`null` 체크 같은)들을 검사해야 한다
- 메서드가 중간에 모호한 예외를 던지며 실패 가능
- 메서드가 수행되지만 잘못된 결과 반환 가능
- 객체를 이상한 상태로 변경하여 알수 없는 시점에 관련 없는 오류 반환

`public`과 `protected` 메서드는 던지는 예외를 문서화 해야됨  
→ 보통 `IllegalArgumentException`, `IndexOutOfBoundsException`, `NullPointerException`

java7 에 추가된 `Objects.requireNonNull` 메서드,  
java9 에 추가된 `checkFromIndexSize`, `checkFromToIndex`, `checkIndex` 메서드를 사용해도 좋다


### 유효성 검사 규칙 예외
- 유효성 검사 비용이 지나치게 높거나 실용적이지 않음
- 계산과정에서 암묵적으로 검사가 수행
  - 하지만 암묵적인 유효 검사에 너무 의존하면 실패 원자성을 해칠 수 있음


<br/>


## 아이템 50. 적시에 방어적 복사본을 만들라

### 클라이언트가 불변식을 깬다고 생각하고 방어적으로 프로그래밍하자
- 불변 객체 사용
- 가변 매개변수를 방어적으로 복사(defensive copy) 하여 사용
  - 방어적으로 복사하고 복사본으로 유효성 검사
  - 매개변수가 외부 클라이언트에게 확장될 수 있는 타입이라면 `clone` 사용 금지 (악의를 가진 하위 타입으로 복사될 수 있음)
- 접근자 메서드에서는 가변 필드의 방어적 복사본을 반환 
  - 이 경우에는 `clone` 사용 가능
  

> 방어적 복사에는 성능 저하가 따를 수 있다.  
> 클래스와 클라이언트가 상호 신뢰할 수 있다면 불변식이 깨지더라도 방어적 복사를 생략해도 된다.    
> 대신, 매개변수나 반환값을 수정하면 안된다고 문서화하자 

```java 
Date start = new Date();
Date end = new Date();
Period p = new Period(start, end);
end.setYear(78); // 수정되면 안됨
```

위처럼 `Date` 사용으로 인해 불변식이 깨질 수 있다.  
`Date`는 예전 api 이므로 불변인 `Instant`, `LocalDateTime`, `ZonedDateTime`을 이용하자  

<br/>

## 아이템 51. 메서드 시그니처를 신중히 설계하라

### 메서드 이름을 신중히 짓자
- 항상 표준 명명 규칙을 따라야 함
- 같은 패키지에 속한 이름들과 일관되게 짓기
- 개발자 커뮤니티에서 널리 받아들여지는 이름으로 짓기
- 긴 이름 피하기

### 편의 메서드를 너무 많이 만들지 말자
- 메서드가 너무 많은 클래스와 인터페이스는 사용하고, 문서화하고, 테스트, 유지보수가 어려움
- 확신이 서지 않으면 만들지 말자

### 매개변수 목록은 짧게 유지
- 4개 이하 추천
- 같은 타입의 매개변수가 여러개 나오면 순서가 잘못되도 실행될 수 있어 문제가 된다

#### 매개변수 목록을 줄이는 방법
- 매개변수 목록을 부분집합으로 받도록 여러 메서드로 쪼개기
- 매개변수 여러 개를 묶어주는 도우미 클래스 만들기
- 빌더 패턴을 메서드 호출에 응용
  - 매개변수들의 객체를 정의하고 `setter`를 호출해 필요한 값 설정
  
### 매개변수의 타입으로는 클래스보다는 인터페이스가 낫다
- 인터페이스를 직접 이용 (ex. `HashMap` 보다 `Map`)

### `boolean`보다는 원소 2개짜리 열거 타입이 낫다
- 메서드 이름이 `boolean` 을 받아야 명확할 때는 예외
- 새로운 타입이 생긴다면 쉽게 추가할 수 있음 
- 다른 의존성이 생긴다면 리팩터링이 가능

