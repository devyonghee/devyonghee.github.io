---
title: '[SQL AntiPattern] 4부 애플리케이션 개발 안티패턴'
tags: [book, sql anti pattern, database, sql]
categories: book
---

SQL 을 효과적으로 활용하기 위해 SQL AntiPattern 의 내용을 정리한다.  
4부에서는 애플리케이션에서 SQL 을 다루는 방법에 대해 알아본다.  

<!--more-->

<br/>

## 20장 읽을 수 있는 패스워드: 패스워드를 복구하거나 재설정하기

대부분 사용자가 패스워드를 잊어버린 경우, 
이메일 피드백을 통해 패스워드를 복구하거나 재설정하는 기능을 제공한다. 

### 안티패턴: 패스워드를 평문으로 저장하기

패스워드를 평문으로 담은 이메일로 제공해준다면, 
심각한 보안 결함이 되고 접근 권한을 제공해줄 수 있기 때문에 위험하다.  

- **패스워드 저장**
  - 패스워드를 평문으로 저장하거나 평문 상태로 전달하면 안전하지 않음
  - 해커가 네트워크 패킷을 가로채 SQL 문 확인 가능
  - 데이터베이스 서버에서 접근 권한을 제공해줄 수 있음
  - 백업 데이터를 읽을 수 있음
- **패스워드 인증**
  - 패스워드가 평문으로 저장되어 있으면 평문으로 비교 수행
  - 공격자에게 패스워드가 노출될 위험이 있음
- **이메일로 패스워드 보내기**
  - 이메일은 해커가 가로채거나, 로깅, 저장할 수 있음

#### 사용이 합당한 경우

- 애플리케이션이 다른 서드파티 서비스에 접근해야 하는 경우
- 인트라넷 애플리케이션인 경우

### 해법: 패스워드의 소금 친 해시 값을 저장한다

- **해시 함수 이해하기**
  - 일방향 해시 함수로 패스워드 부호화(encode)
    - ex) SHA-256 알고리즘을 사용하면 문자열 길이가 항상 같음
  - 역을 구하기 어려움
- **SQL 에서 해시 사용하기**
  - `SHA2()` 함수를 사용해 해시 값을 생성
  - 해시 함수가 리턴할 수 없는 값(16진수가 아닌 값)으로 변경하면 계정을 잠글 수 있음
    - ex) `noaccess`
- **해시에 소금 추가하기**
  - 소금(salt): 일방향 함수의 입력값에 덧붙이는 랜덤비트
  - 해시 값을 구하기 전에 패스워드에 덧붙이는 무의미한 바이트열임 (8바이트면 충분)
  - 데이터베이스에서 해커가 해시 값과 비교하여 찾을 수 없도록 임의아 값을 추가
- **SQL 에서 패스워드 숨기기**
  - 네트워크 패킷 또는 SQL 로그 파일을 가로챈다면 패스워드가 노출될 수 있음
  - 애플리케이션 코드에서 해시 값을 계산해 SQL 에서 활용
  - 브라우저와 웹 애플리케이션 서버에서는 HTTPS 같은 보안 프로토콜 사용
- **패스워드 복구가 아닌 패스워드 재설정 사용하기**
  - 해시 값이 저장되어 있으므로 복구 불가능
  - 이메일로 패스워드 대신 임시 패스워드를 보냄
    - 짧은 시간이 지나면 만료시킬 수 있음
  - 아이디에 유일한 토큰을 할당하여 이메일로 보내 패스워드 재설정
- 안전한 암호학 기술
  - PBKDF2: 키 강화 표준
  - Bcrypt: 적응성 해시 함수 구현

